<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Akuntansi</title>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
    <!-- PDF & Excel Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
    <!-- Login Page -->
    <div id="login-page" class="container d-flex align-items-center justify-content-center" style="min-height: 100vh;">
        <div class="card shadow-lg" style="width: 100%; max-width: 400px;">
            <div class="card-header bg-primary text-white text-center py-3">
                <h4 class="mb-0"><i class="bi bi-shield-lock"></i> Sistem Akuntansi</h4>
            </div>
            <div class="card-body p-4">
                <form id="login-form">
                    <div class="mb-3">
                        <label class="form-label">Username</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-person"></i></span>
                            <input type="text" class="form-control" id="login-username" required>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Password</label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-key"></i></span>
                            <input type="password" class="form-control" id="login-password" required>
                        </div>
                    </div>
                    <div class="d-grid">
                        <button type="submit" class="btn btn-primary">Login</button>
                    </div>
                    <div class="mt-3 text-center small text-muted">
                        <p class="mb-1">Default Credentials:</p>
                        <div>admin / 123</div>
                        <div>user / 123</div>
                        <div>direktur / 123</div>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main App Wrapper -->
    <div id="main-app" style="display: none;">

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container">
            <a class="navbar-brand" href="#landing-page">
                <i class="bi bi-speedometer2"></i> Dashboard Admin
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <!-- Populated by AuthManager -->
                </ul>
            </div>
        </div>
    </nav>

    <!-- 1. Landing Page / Dashboard -->
    <section id="landing-page" class="app-section active-section">
        <div class="container">
            <!-- Dashboard Analytics -->
            <div class="row mb-4" id="dashboard-analytics">
                <!-- Analytics Cards will be injected here -->
            </div>

            <!-- Dashboard Charts -->
            <div class="row" id="dashboard-charts">
                <div class="col-12 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header bg-white fw-bold d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-graph-up"></i> Tren Keuangan 2025</span>
                            <button class="btn btn-sm btn-outline-secondary" onclick="UI.renderDashboardAnalytics()"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
                        </div>
                        <div class="card-body">
                            <canvas id="financeChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-12 mb-4">
                    <div class="card h-100 shadow-sm">
                        <div class="card-header bg-white fw-bold">
                            <i class="bi bi-pie-chart-fill"></i> Komposisi Pendapatan
                        </div>
                        <div class="card-body">
                            <canvas id="revenueChart" style="max-height: 300px;"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="container py-4">
        
        <!-- 2. Jurnal Bulanan (Input + Current Table) -->
        <section id="journal-monthly" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Input Transaksi</h2>
            
            <!-- Input Form -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <i class="bi bi-pencil-square"></i> Input Transaksi Baru
                </div>
                <div class="card-body">
                    <form id="transaction-form">
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <label for="trx-date" class="form-label required">Tanggal</label>
                                <input type="date" class="form-control" id="trx-date" required>
                            </div>
                            <div class="col-md-8">
                                <label for="trx-type" class="form-label required">Jenis Transaksi</label>
                                <select class="form-select" id="trx-type" required>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label for="trx-desc" class="form-label required">Keterangan Detail</label>
                                <input type="text" class="form-control" id="trx-desc" placeholder="Keterangan tambahan..." required>
                            </div>
                            <div class="col-md-4">
                                <label for="trx-amount" class="form-label required">Nominal (Rp)</label>
                                <input type="number" class="form-control" id="trx-amount" placeholder="0" min="1" required>
                            </div>
                        </div>

                        <div class="alert alert-light border small text-muted">
                            <i class="bi bi-info-circle"></i> Jurnal Akuntansi (Debit/Kredit) akan dibuat otomatis oleh sistem berdasarkan jenis transaksi yang dipilih agar selalu <b>Balance</b>.
                        </div>

                        <div class="d-grid">
                            <button type="submit" class="btn btn-warning btn-lg text-white" id="btn-process">
                                <i class="bi bi-gear-fill"></i> Proses Jurnal
                            </button>
                        </div>
                    </form>

                    <!-- Preview Section (Initially Hidden) -->
                    <div id="journal-preview" class="mt-4 border-top pt-3" style="display: none;">
                        <h5 class="text-center mb-3">Preview Jurnal Otomatis</h5>
                        <div class="table-responsive mb-3">
                            <table class="table table-bordered table-sm bg-white">
                                <thead class="table-light">
                                    <tr>
                                        <th>Akun</th>
                                        <th class="text-end">Debit</th>
                                        <th class="text-end">Kredit</th>
                                    </tr>
                                </thead>
                                <tbody id="preview-table-body">
                                    <!-- Populated by JS -->
                                </tbody>
                            </table>
                        </div>
                        <div class="d-grid">
                            <button type="button" class="btn btn-success btn-lg" id="btn-confirm-save">
                                <i class="bi bi-check-circle-fill"></i> Simpan Transaksi
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Current Month Table -->
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="mb-0">Transaksi Bulan Berjalan (Belum Closing)</h5>
                <button id="btn-closing-month" class="btn btn-danger btn-sm"><i class="bi bi-lock-fill"></i> Closing Bulanan</button>
            </div>
            <div class="alert alert-info py-2 small">
                <i class="bi bi-info-circle"></i> Transaksi di bawah ini belum masuk ke Laporan Keuangan. Lakukan <b>Closing Bulanan</b> untuk memindahkannya ke Jurnal Tahunan & Laporan.
            </div>
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Akun</th>
                                    <th class="text-end">Debit</th>
                                    <th class="text-end">Kredit</th>
                                </tr>
                            </thead>
                            <tbody id="current-journal-table-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 3. Jurnal Tahunan (Full History) -->
        <section id="journal-yearly" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Jurnal Tahunan</h2>
            
            <div class="card mb-3">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-6">
                             <div class="input-group">
                                <label class="input-group-text" for="journal-year-filter">Tahun</label>
                                <select class="form-select" id="journal-year-filter">
                                    <option value="">Semua Tahun</option>
                                    <!-- Populated by JS -->
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6 text-end">
                            <button class="btn btn-outline-danger btn-sm me-1" onclick="ExportManager.exportYearlyJournal('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                            <button class="btn btn-outline-success btn-sm me-2" onclick="ExportManager.exportYearlyJournal('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                            <small class="text-muted d-block">Menampilkan transaksi yang sudah di-posting (Closing Bulanan)</small>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header bg-success text-white">
                    <i class="bi bi-journal-check"></i> Data Transaksi Terposting
                </div>
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="journal-table" class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Akun</th>
                                    <th class="text-end">Debit</th>
                                    <th class="text-end">Kredit</th>
                                </tr>
                            </thead>
                            <tbody id="journal-table-body">
                                <!-- JS Populated -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- New: Tutup Buku Section -->
        <section id="closing" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Tutup Buku Tahunan</h2>
            
            <div class="card mb-4 border-warning">
                <div class="card-header bg-warning text-dark fw-bold">
                    <i class="bi bi-calendar-check"></i> Tutup Buku Tahunan (Year-End Closing)
                </div>
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <p class="mb-0">
                                Proses ini akan menghitung Laba/Rugi tahunan dan memindahkan saldo akun Pendapatan & Beban ke <strong>Laba Ditahan (Equity)</strong>.
                                <br><small class="text-muted">Pastikan semua transaksi tahun tersebut sudah di-input dan di-posting.</small>
                            </p>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="input-group">
                                <select class="form-select" id="closing-year-select">
                                    <!-- Populated by JS -->
                                </select>
                                <button class="btn btn-danger" onclick="UI.handleYearEndClosing()">
                                    <i class="bi bi-check-circle"></i> Proses Tutup Buku
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <span>Riwayat Tutup Buku</span>
                    <div>
                        <button class="btn btn-sm btn-danger" onclick="ExportManager.exportClosingHistory('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                        <button class="btn btn-sm btn-success" onclick="ExportManager.exportClosingHistory('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                    </div>
                </div>
                <div class="card-body p-0">
                     <div class="table-responsive">
                        <table id="closing-history-table" class="table table-striped mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Tahun</th>
                                    <th class="text-end">Nominal</th>
                                </tr>
                            </thead>
                            <tbody id="closing-history-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            
            <div class="alert alert-info">
                <i class="bi bi-info-circle"></i> Fitur ini hanya digunakan pada akhir periode akuntansi (akhir tahun).
            </div>
        </section>

        <!-- New: Laporan Transaksi -->
        <section id="transaction-report" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Laporan Transaksi</h2>
            <div class="card mb-3">
                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-3">
                            <label for="report-start-date" class="form-label">Dari Tanggal</label>
                            <input type="date" class="form-control" id="report-start-date">
                        </div>
                        <div class="col-md-3">
                            <label for="report-end-date" class="form-label">Sampai Tanggal</label>
                            <input type="date" class="form-control" id="report-end-date">
                        </div>
                        <div class="col-md-3">
                            <button class="btn btn-primary w-100" onclick="UI.renderTransactionReport()">
                                <i class="bi bi-search"></i> Tampilkan
                            </button>
                        </div>
                        <div class="col-md-3">
                             <label class="form-label d-block">&nbsp;</label>
                             <div class="d-flex gap-2">
                                <button class="btn btn-danger flex-fill" onclick="ExportManager.exportTransactionReport('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                                <button class="btn btn-success flex-fill" onclick="ExportManager.exportTransactionReport('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                             </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-body p-0">
                     <div class="table-responsive">
                        <table id="transaction-report-table" class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th class="text-end">Nominal (Rp)</th>
                                    <th class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody id="transaction-report-body">
                                <!-- Content -->
                            </tbody>
                            <tfoot class="table-light fw-bold">
                                <tr>
                                    <td colspan="2" class="text-end">TOTAL</td>
                                    <td class="text-end" id="report-total-amount">0</td>
                                    <td></td>
                                </tr>
                            </tfoot>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. Reports View -->
        <section id="reports" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Laporan Keuangan</h2>
            
            <ul class="nav nav-tabs mb-3" id="reportTabs" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="tb-tab" data-bs-toggle="tab" data-bs-target="#trial-balance" type="button">Neraca Saldo</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="pl-tab" data-bs-toggle="tab" data-bs-target="#income-statement" type="button">Laba Rugi</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="bs-tab" data-bs-toggle="tab" data-bs-target="#balance-sheet" type="button">Neraca (Posisi Keuangan)</button>
                </li>
            </ul>

            <div class="tab-content" id="reportTabsContent">
                <!-- Trial Balance -->
                <div class="tab-pane fade show active" id="trial-balance">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Neraca Saldo (Trial Balance)</span>
                            <div>
                                <button class="btn btn-sm btn-danger" onclick="ExportManager.exportTrialBalance('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                                <button class="btn btn-sm btn-success" onclick="ExportManager.exportTrialBalance('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table id="trial-balance-table" class="table table-bordered table-striped mb-0 text-nowrap">
                                    <thead class="table-light text-center align-middle">
                                        <tr>
                                            <th rowspan="2">Akun</th>
                                            <th colspan="2">Saldo Awal (Bulan Lalu)</th>
                                            <th colspan="2">Pergerakan (Bulan Ini)</th>
                                            <th colspan="2">Saldo Akhir (Bulan Ini)</th>
                                        </tr>
                                        <tr>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Kredit</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Kredit</th>
                                            <th class="text-end">Debit</th>
                                            <th class="text-end">Kredit</th>
                                        </tr>
                                    </thead>
                                    <tbody id="trial-balance-body"></tbody>
                                    <tfoot class="table-dark">
                                        <tr>
                                            <td>TOTAL</td>
                                            <td class="text-end" id="tb-start-debit">0</td>
                                            <td class="text-end" id="tb-start-credit">0</td>
                                            <td class="text-end" id="tb-move-debit">0</td>
                                            <td class="text-end" id="tb-move-credit">0</td>
                                            <td class="text-end" id="tb-end-debit">0</td>
                                            <td class="text-end" id="tb-end-credit">0</td>
                                        </tr>
                                    </tfoot>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Income Statement -->
                <div class="tab-pane fade" id="income-statement">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Laporan Laba Rugi</span>
                            <div>
                                <button class="btn btn-sm btn-danger" onclick="ExportManager.exportIncomeStatement('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                                <button class="btn btn-sm btn-success" onclick="ExportManager.exportIncomeStatement('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table id="income-statement-table" class="table table-hover mb-0 text-nowrap">
                                    <thead class="table-light text-center align-middle">
                                        <tr>
                                            <th rowspan="2">Akun</th>
                                            <th>Saldo Awal</th>
                                            <th>Pergerakan</th>
                                            <th>Saldo Akhir</th>
                                        </tr>
                                        <tr>
                                            <th>(Bulan Lalu)</th>
                                            <th>(Bulan Ini)</th>
                                            <th>(Bulan Ini)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="income-statement-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Balance Sheet -->
                <div class="tab-pane fade" id="balance-sheet">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Laporan Posisi Keuangan (Neraca)</span>
                            <div>
                                <button class="btn btn-sm btn-danger" onclick="ExportManager.exportBalanceSheet('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                                <button class="btn btn-sm btn-success" onclick="ExportManager.exportBalanceSheet('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                            </div>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive">
                                <table id="balance-sheet-table" class="table table-hover mb-0 text-nowrap">
                                    <thead class="table-light text-center align-middle">
                                        <tr>
                                            <th rowspan="2">Akun</th>
                                            <th>Saldo Awal</th>
                                            <th>Pergerakan</th>
                                            <th>Saldo Akhir</th>
                                        </tr>
                                        <tr>
                                            <th>(Bulan Lalu)</th>
                                            <th>(Bulan Ini)</th>
                                            <th>(Bulan Ini)</th>
                                        </tr>
                                    </thead>
                                    <tbody id="balance-sheet-body"></tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 5. General Ledger -->
        <section id="general-ledger" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Buku Besar (General Ledger)</h2>
            <div class="card mb-3">
                <div class="card-body">
                    <div class="row g-3 align-items-end">
                        <div class="col-md-5">
                            <label for="gl-account-select" class="form-label">Pilih Akun</label>
                            <select id="gl-account-select" class="form-select">
                                <option value="">Semua Akun</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="form-check form-switch mb-2">
                                <input class="form-check-input" type="checkbox" id="gl-show-unposted">
                                <label class="form-check-label" for="gl-show-unposted">Tampilkan Belum Closing</label>
                            </div>
                        </div>
                        <div class="col-md-4 text-end">
                            <div class="btn-group me-2">
                                <button class="btn btn-outline-danger btn-sm" onclick="ExportManager.exportGeneralLedger('pdf')"><i class="bi bi-file-pdf"></i> PDF</button>
                                <button class="btn btn-outline-success btn-sm" onclick="ExportManager.exportGeneralLedger('excel')"><i class="bi bi-file-excel"></i> Excel</button>
                            </div>
                            <a href="#journal-yearly" class="btn btn-outline-secondary btn-sm"><i class="bi bi-journal-bookmark"></i> Lihat Jurnal Tahunan</a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table id="gl-table" class="table table-striped table-hover mb-0">
                            <thead class="table-dark">
                                <tr>
                                    <th>Tanggal</th>
                                    <th>Keterangan</th>
                                    <th>Akun</th>
                                    <th class="text-end">Debit</th>
                                    <th class="text-end">Kredit</th>
                                    <th class="text-end">Saldo</th>
                                </tr>
                            </thead>
                            <tbody id="gl-table-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- 6. Settings / Data -->
        <section id="settings" class="app-section">
            <h2 class="mb-4 border-bottom pb-2">Pengaturan & Manajemen Data</h2>

            <!-- Reset Data Section -->
            <div class="card border-danger mb-4">
                <div class="card-header bg-danger text-white">
                    <i class="bi bi-exclamation-triangle-fill"></i> Zone Bahaya
                </div>
                <div class="card-body text-center">
                    <h5 class="card-title text-danger">Reset Aplikasi</h5>
                    <p class="card-text">Hapus semua data transaksi dan pengaturan dari Local Storage browser ini. Tindakan ini tidak dapat dibatalkan.</p>
                    <button id="btn-reset" class="btn btn-danger"><i class="bi bi-trash"></i> Hapus Semua Data</button>
                </div>
            </div>

            <div class="row">
                <div class="col-md-4 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-primary text-white">
                            <i class="bi bi-building"></i> Profil Perusahaan
                        </div>
                        <div class="card-body">
                            <form id="company-profile-form">
                                <div class="mb-3">
                                    <label class="form-label">Nama Perusahaan</label>
                                    <input type="text" class="form-control" id="setting-company-name" required>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Alamat</label>
                                    <textarea class="form-control" id="setting-company-address" rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Telepon</label>
                                    <input type="text" class="form-control" id="setting-company-phone">
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-control" id="setting-company-email">
                                </div>
                                <button type="submit" class="btn btn-primary w-100">Simpan Profil</button>
                            </form>
                        </div>
                    </div>
                </div>

                <div class="col-md-8 mb-4">
                    <div class="card h-100">
                        <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                            <span><i class="bi bi-list-check"></i> Jenis Transaksi</span>
                            <button class="btn btn-sm btn-light text-success fw-bold" onclick="UI.showAddTransactionTypeModal()">
                                <i class="bi bi-plus-circle"></i> Tambah Baru
                            </button>
                        </div>
                        <div class="card-body p-0">
                            <div class="table-responsive" style="max-height: 500px;">
                                <table class="table table-striped table-hover mb-0">
                                    <thead class="table-light sticky-top">
                                        <tr>
                                            <th>Nama Transaksi</th>
                                            <th>Debit</th>
                                            <th>Kredit</th>
                                            <th class="text-center" style="width: 100px;">Aksi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="settings-trx-types-body">
                                        <!-- JS Populated -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Modal for Add/Edit Transaction Type -->
        <div class="modal fade" id="trxTypeModal" tabindex="-1">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="trxTypeModalLabel">Tambah Jenis Transaksi</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="trx-type-form">
                            <input type="hidden" id="trx-type-id">
                            <div class="mb-3">
                                <label class="form-label">Nama Transaksi</label>
                                <input type="text" class="form-control" id="trx-type-name" required placeholder="Contoh: Beli Pulsa Listrik">
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Akun Debit</label>
                                    <select class="form-select account-select" id="trx-type-debit" required>
                                        <!-- Populated via JS -->
                                    </select>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label class="form-label">Akun Kredit</label>
                                    <select class="form-select account-select" id="trx-type-credit" required>
                                        <!-- Populated via JS -->
                                    </select>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Template Keterangan</label>
                                <input type="text" class="form-control" id="trx-type-desc" placeholder="Contoh: Pembelian token listrik">
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                        <button type="button" class="btn btn-primary" onclick="UI.saveTransactionType()">Simpan</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    </div> <!-- End Main App -->

    <!-- Bootstrap Bundle JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- App Logic -->
    <script src="js/data.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/accounting.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/export.js"></script>
    <script src="js/app.js"></script>
    <script>
        // Diagnostic Script
        window.addEventListener('load', function() {
            const checks = {
                'DataManager': typeof DataManager !== 'undefined',
                'Accounting': typeof Accounting !== 'undefined',
                'UI': typeof UI !== 'undefined'
            };
            
            let allOk = true;
            let errors = [];
            
            for (const [module, loaded] of Object.entries(checks)) {
                if (!loaded) {
                    allOk = false;
                    errors.push(module + ' failed to load');
                }
            }
            
            if (!allOk) {
                const msg = 'System Diagnostic Error:\n' + errors.join('\n') + '\n\nCheck browser console for details.';
                console.error(msg);
                alert(msg);
            } else {
                console.log('All modules loaded successfully.');
            }
        });
    </script>
</body>
</html>
